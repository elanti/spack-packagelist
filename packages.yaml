axis:
  - architecture
  - compiler
  - mpi
  - lapack

combinations:
  core:
    architecture: 'x86_E5v2_IntelIB:x86_E5v2_Mellanox_GPU:x86_E5v3_IntelIB'
    compiler: 'gcc@4.4.7'
    mpi: None
    lapack: None
  gnu:
    architecture:
      - 'x86_E5v2_IntelIB:x86_E5v3_IntelIB'
      - 'x86_E5v2_Mellanox_GPU'
    compiler: 'gcc@5.3.0'
    mpi:
      - 'openmpi@1.10.2+pmi+psm+slurm+thread_multiple+sqlite3~hwloc:mvapich2@2.2b+psm+slurm'
      - 'openmpi@1.10.2+pmi+psm+slurm+thread_multiple+sqlite3~hwloc:mvapich2@2.2b+nemesisib+slurm'
    lapack: 'openblas@0.2.18~openmp:openblas@0.2.18+openmp'

packages:
  core:
    target_matrix:
      - core
    requires:
      architecture: true
      compiler: true
    specs:
      - cmake@3.5.2
      - m4@1.4.17
      - autoconf@2.69
      - automake@1.15
      - libtool@2.4.6
      - lmod@6.4.1
  cuda-runtime:
    target_matrix:
      - core
    target_filter:
      system: 'x86_E5v2_Mellanox_GPU'
    requires:
      architecture: true
      compiler: true
    specs:
      - cuda@7.5.18
  serial:
    target_matrix:
      - gnu
    requires:
      architecture: true
      compiler: true
    specs:
      - valgrind@3.11.0~boost~mpi
      - gdb@7.11
      - fftw@3.3.4
      - fftw@3.3.4+openmp
      - glpk@4.57+gmp
      - gsl@2.1
      - hdf5@1.8.16+szip
      - metis@5.1.0+real64
      - scotch@6.0.3+esmumps~metis
      - openblas@0.2.18~openmp
      - openblas@0.2.18+openmp
      - openmpi@1.10.2+pmi+psm+slurm+thread_multiple+sqlite3~hwloc
      - mvapich2@2.2b+psm+slurm
      - python@3.5.1
      - python@2.7.11
      - netcdf@4.4.0~mpi^hdf5@1.8.16+szip
  lapack:
    target_matrix:
      - gnu
    requires:
      architecture: true
      compiler: true
      lapack: true
    specs:
      - arpack-ng@3.3.0~mpi
  mpi:
    target_matrix:
      - gnu
    requires:
      architecture: true
      compiler: true
      mpi: true
    specs:
      - boost@1.61.0+icu_support+mpi+python
      - fftw@3.3.4+mpi~openmp
      - fftw@3.3.4+mpi+openmp
      - hdf5@1.8.16+mpi~cxx+szip
      - scotch@6.0.3+esmumps+mpi~metis
      - scorep@1.4.2
      - parmetis@4.0.3^metis@5.1.0+real64
      - netcdf@4.4.0+mpi^hdf5@1.8.16+mpi~cxx+szip
      # Applications
      - gromacs@5.1.2+mpi^fftw@3.3.4+mpi
      - gromacs@5.1.2+mpi^fftw@3.3.4+mpi+openmp
  'mpi::lapack':
    target_matrix:
      - gnu
    requires:
      architecture: true
      compiler: true
      mpi: true
      lapack: true
    specs:
      - arpack-ng@3.3.0+mpi
      - netlib-scalapack@2.0.2
#      - mumps@5.0.1+mpi+parmetis+metis+scotch+ptscotch^parmetis@4.0.3^metis@5.1.0+real64^scotch@6.0.3+esmumps+mpi~metis
  'mpi::lapack~openmp':
    target_matrix:
      - gnu
    target_filter:
      lapack: 'openblas@0.2.18~openmp'
    requires:
      architecture: true
      compiler: true
      mpi: true
      lapack: true
    specs:
      - espresso@5.3.0+mpi+scalapack^fftw@3.3.4+mpi~openmp^netlib-scalapack@2.0.2
